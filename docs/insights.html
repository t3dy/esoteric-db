<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esoteric DB - Insights</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #334155;
        }
    </style>
</head>

<body class="p-8">

    <div class="max-w-6xl mx-auto space-y-8">
        <!-- Header -->
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-slate-800">Project Insights</h1>
                <p class="text-slate-500">Visualization Suite â€¢ <a href="index.html"
                        class="text-indigo-600 hover:underline">Back to Landing</a></p>
            </div>
            <div id="status"
                class="text-xs font-mono bg-blue-100 text-blue-700 px-3 py-1 rounded border border-blue-200">Loading
                Data...</div>
        </div>

        <!-- Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

            <!-- Topic Chart -->
            <div class="bg-white p-6 rounded-xl shadow border border-slate-200">
                <h3 class="font-bold text-slate-700 mb-4">Topic Distribution</h3>
                <div class="h-64 relative">
                    <canvas id="topicChart"></canvas>
                </div>
            </div>

            <!-- Timeline Chart -->
            <div class="bg-white p-6 rounded-xl shadow border border-slate-200">
                <h3 class="font-bold text-slate-700 mb-4">Ingestion Timeline</h3>
                <div class="h-64 relative">
                    <canvas id="timelineChart"></canvas>
                </div>
            </div>

            <!-- Word Cloud -->
            <div class="bg-white p-6 rounded-xl shadow border border-slate-200 col-span-1 md:col-span-2">
                <h3 class="font-bold text-slate-700 mb-4">Semantic Cloud</h3>
                <div class="h-96 relative bg-slate-50 rounded" id="wordCloudContainer">
                    <canvas id="wordCloudCanvas" class="w-full h-full"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function init() {
            try {
                const res = await fetch('stats.json');
                if (!res.ok) throw new Error("Failed to load stats.json");
                const stats = await res.json();

                renderCharts(stats);
                document.getElementById('status').innerText = "System Ready";
                document.getElementById('status').className = "text-xs font-mono bg-emerald-100 text-emerald-700 px-3 py-1 rounded border border-emerald-200";

            } catch (e) {
                document.getElementById('status').innerText = "Error: " + e.message;
                document.getElementById('status').className = "text-xs font-mono bg-red-100 text-red-700 px-3 py-1 rounded border border-red-200";
                console.error(e);
            }
        }

        function renderCharts(stats) {
            // 1. Topic Doughnut
            const ctxTopic = document.getElementById('topicChart').getContext('2d');
            new Chart(ctxTopic, {
                type: 'doughnut',
                data: {
                    labels: stats.topics.map(s => s.label),
                    datasets: [{
                        data: stats.topics.map(s => s.value),
                        backgroundColor: [
                            '#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899', '#6366F1'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'right' } }
                }
            });

            // 2. Timeline Line Chart
            const ctxTimeline = document.getElementById('timelineChart').getContext('2d');
            new Chart(ctxTimeline, {
                type: 'line',
                data: {
                    labels: stats.timeline.map(s => s.label),
                    datasets: [{
                        label: 'Documents Added',
                        data: stats.timeline.map(s => s.value),
                        borderColor: '#4F46E5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } }
                }
            });

            // 3. Word Cloud
            const canvas = document.getElementById('wordCloudCanvas');
            const container = document.getElementById('wordCloudContainer');

            // Explicitly set canvas size to match container to prevent blurring/distortion
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;

            WordCloud(canvas, {
                list: stats.wordcloud.map(x => [x.word, x.weight]),
                gridSize: 8,
                weightFactor: (size) => Math.log(size + 1) * 15,
                fontFamily: 'Inter, sans-serif',
                color: 'random-dark',
                rotateRatio: 0.5,
                backgroundColor: 'transparent'
            });
        }

        init();
    </script>
</body>

</html>