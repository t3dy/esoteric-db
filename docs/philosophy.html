<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Esoteric DB - Philosophy of the Dataset</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,700;1,400&family=Inter:wght@400;900&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
        }

        .serif {
            font-family: 'Crimson Pro', serif;
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .canvas-container {
            position: relative;
            overflow: hidden;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>

<body class="p-8" x-data="philosophyApp()">

    <div class="max-w-7xl mx-auto space-y-12">
        <!-- Header -->
        <div class="flex justify-between items-end border-b border-indigo-500/20 pb-8">
            <div>
                <h1 class="text-6xl font-black italic serif text-indigo-400">The Mansion's Soul</h1>
                <p class="text-slate-400 font-mono text-xs uppercase tracking-[0.3em] mt-2">Interactive Philosophy of
                    the Dataset</p>
            </div>
            <a href="index.html"
                class="bg-slate-800 px-6 py-2 rounded-full font-bold text-sm hover:bg-slate-700 transition">Exit to
                Reality</a>
        </div>

        <!-- Toy 1: Atomic Ingestion -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
            <div class="space-y-6">
                <div class="text-indigo-500 text-xs font-black uppercase tracking-widest">Principle #1</div>
                <h2 class="text-4xl font-bold serif">Atomic Ingestion</h2>
                <p class="text-slate-400 leading-relaxed">
                    We do not store "Chats." We store <strong>Atoms of Thought</strong>. Every message is hashed (MD5)
                    and shattered into discrete entities.
                    <br><br>
                    <em class="text-indigo-400">Click the box to simulate the ingestion of a new PDF.</em>
                </p>
                <div class="p-4 bg-slate-900 border border-slate-700 rounded-xl font-mono text-xs text-green-400 h-32 overflow-hidden"
                    x-ref="log">
                    > System ready...
                </div>
            </div>
            <div class="glass h-[400px] rounded-[2.5rem] relative canvas-container cursor-pointer"
                @click="spawnAtoms()">
                <div
                    class="absolute inset-0 flex items-center justify-center text-indigo-500/20 font-black text-9xl select-none pointer-events-none">
                    MD5</div>
                <canvas id="atomic-canvas"></canvas>
            </div>
        </section>

        <!-- Toy 2: Historiographical Haunting -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
            <div class="order-2 lg:order-1 glass h-[400px] rounded-[2.5rem] p-8 flex items-end justify-center gap-8">
                <!-- Bars -->
                <div class="w-24 bg-indigo-900/50 rounded-t-3xl relative group transition-all duration-1000"
                    :style="`height: ${hermesHeight}%`">
                    <div class="absolute bottom-4 left-0 w-full text-center font-bold text-indigo-400">HERMES</div>
                    <div class="absolute -top-8 left-0 w-full text-center font-black text-white"
                        x-text="hermesHeight + '%'"></div>
                </div>
                <div class="w-24 bg-amber-600/50 rounded-t-3xl relative group transition-all duration-1000"
                    :style="`height: ${paraHeight}%`">
                    <div class="absolute bottom-4 left-0 w-full text-center font-bold text-amber-400">PARACELSUS</div>
                    <div class="absolute -top-8 left-0 w-full text-center font-black text-white"
                        x-text="paraHeight + '%'"></div>
                    <div class="absolute inset-0 bg-amber-500/20 animate-pulse rounded-t-3xl"></div>
                </div>
            </div>
            <div class="space-y-6 order-1 lg:order-2">
                <div class="text-amber-500 text-xs font-black uppercase tracking-widest">Principle #2</div>
                <h2 class="text-4xl font-bold serif">Historiographical Haunting</h2>
                <p class="text-slate-400 leading-relaxed">
                    The database is not neutral. It is "Haunted" by the biases of your research.
                    Currently, <strong>Paracelsus</strong> (the Alchemical Reformer) dominates the mention-count over
                    <strong>Hermes Trismegistus</strong> (the Ancient Sage).
                    <br><br>
                    This visualization shows the "Distortion Field" of your current inquiry state.
                </p>
                <div class="flex gap-4">
                    <button @click="shiftEra('renaissance')"
                        class="px-4 py-2 bg-amber-900/40 text-amber-400 border border-amber-900 rounded-lg text-xs font-bold hover:bg-amber-900">Empower
                        Paracelsus</button>
                    <button @click="shiftEra('antiquity')"
                        class="px-4 py-2 bg-indigo-900/40 text-indigo-400 border border-indigo-900 rounded-lg text-xs font-bold hover:bg-indigo-900">Restore
                        Hermes</button>
                </div>
            </div>
        </section>

        <!-- Toy 3: The Golden Chain -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
            <div class="space-y-6">
                <div class="text-emerald-500 text-xs font-black uppercase tracking-widest">Principle #3</div>
                <h2 class="text-4xl font-bold serif">The Golden Chain</h2>
                <p class="text-slate-400 leading-relaxed">
                    Knowledge is not a pile of bricks; it is a <strong>Lineage of Sparks</strong>.
                    The "Rich Profile" metadata connects entities not just by topic, but by <em>transmission</em>.
                </p>
                <div class="bg-slate-900 p-6 rounded-xl border border-emerald-900/30">
                    <div class="flex justify-between text-xs font-mono text-emerald-600 mb-2">
                        <span>TRANSMISSION_VECTOR</span>
                        <span>CONFIDENCE: 98.4%</span>
                    </div>
                    <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                        <div class="h-full bg-emerald-500 w-[80%] animate-pulse"></div>
                    </div>
                </div>
            </div>
            <div class="glass h-[400px] rounded-[2.5rem] relative flex items-center justify-center overflow-hidden"
                id="chain-container">
                <!-- D3 Graph -->
            </div>
        </section>

    </div>

    <script>
        function philosophyApp() {
            return {
                hermesHeight: 30,
                paraHeight: 85,
                init() {
                    this.initAtoms();
                    this.initChain();
                    this.loadStats();
                },
                async loadStats() {
                    try {
                        const res = await fetch('stats.json');
                        if (res.ok) {
                            const data = await res.json();
                            const metrics = data.metrics || [];

                            const hermetic = metrics.find(m => m.name === 'Hermeticism') || { scholar_interest: 30 };
                            const alchemy = metrics.find(m => m.name === 'Alchemy') || { scholar_interest: 85 };

                            // Animate via Alpine transitions
                            this.hermesHeight = hermetic.scholar_interest;
                            this.paraHeight = alchemy.scholar_interest;

                            this.$refs.log.innerHTML += `\n> Live Data: Hermeticism (${this.hermesHeight}%) vs Alchemy (${this.paraHeight}%) loaded.`;
                        }
                    } catch (e) {
                        console.error("Stats load failed", e);
                    }
                },
                spawnAtoms() {
                    const canvas = document.getElementById('atomic-canvas');
                    const ctx = canvas.getContext('2d');
                    for (let i = 0; i < 20; i++) {
                        this.atoms.push({
                            x: Math.random() * canvas.width,
                            y: -20,
                            vx: (Math.random() - 0.5) * 4,
                            vy: Math.random() * 5 + 2,
                            color: `hsl(${Math.random() * 60 + 200}, 80%, 60%)`,
                            size: Math.random() * 5 + 2
                        });
                    }
                    this.$refs.log.innerHTML += `\n> Hashed 20 new thoughts...`;
                    this.$refs.log.scrollTop = this.$refs.log.scrollHeight;
                },
                shiftEra(era) {
                    if (era === 'antiquity') {
                        this.hermesHeight = Math.min(100, this.hermesHeight * 1.5);
                        this.paraHeight = Math.max(10, this.paraHeight * 0.5);
                        this.$refs.log.innerHTML += `\n> Era Shift: PRISCA THEOLOGIA restored.`;
                    } else {
                        // Reset to probable defaults if we drifted too far, or just inverse the scaling
                        this.hermesHeight = Math.max(10, this.hermesHeight * 0.5);
                        this.paraHeight = Math.min(100, this.paraHeight * 1.5);
                        this.$refs.log.innerHTML += `\n> Era Shift: IATROCHEMISTRY dominant.`;
                    }
                },
                atoms: [],
                initAtoms() {
                    const canvas = document.getElementById('atomic-canvas');
                    const ctx = canvas.getContext('2d');

                    const resize = () => {
                        canvas.width = canvas.parentElement.offsetWidth;
                        canvas.height = canvas.parentElement.offsetHeight;
                    };
                    window.addEventListener('resize', resize);
                    resize();

                    const animate = () => {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        this.atoms.forEach((p, i) => {
                            p.x += p.vx;
                            p.y += p.vy;
                            p.vy += 0.1; // gravity

                            // Bounce
                            if (p.y > canvas.height - p.size) {
                                p.y = canvas.height - p.size;
                                p.vy *= -0.6;
                            }
                            if (p.x < 0 || p.x > canvas.width) p.vx *= -1;

                            ctx.fillStyle = p.color;
                            ctx.beginPath();
                            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                            ctx.fill();
                        });
                        requestAnimationFrame(animate);
                    };
                    animate();
                },
                initChain() {
                    const width = 500, height = 400;
                    const svg = d3.select("#chain-container").append("svg")
                        .attr("width", "100%")
                        .attr("height", "100%")
                        .attr("viewBox", [0, 0, width, height]);

                    const data = {
                        nodes: [
                            { id: "Thoth", group: 1 },
                            { id: "Hermes", group: 1 },
                            { id: "Plato", group: 2 },
                            { id: "Ficino", group: 3 },
                            { id: "Agrippa", group: 3 },
                            { id: "Paracelsus", group: 4 },
                            { id: "Dee", group: 4 }
                        ],
                        links: [
                            { source: "Thoth", target: "Hermes" },
                            { source: "Hermes", target: "Plato" },
                            { source: "Plato", target: "Ficino" },
                            { source: "Hermes", target: "Ficino" },
                            { source: "Ficino", target: "Agrippa" },
                            { source: "Ficino", target: "Paracelsus" },
                            { source: "Agrippa", target: "Dee" }
                        ]
                    };

                    const simulation = d3.forceSimulation(data.nodes)
                        .force("link", d3.forceLink(data.links).id(d => d.id).distance(80))
                        .force("charge", d3.forceManyBody().strength(-200))
                        .force("center", d3.forceCenter(width / 2, height / 2));

                    const link = svg.append("g")
                        .attr("stroke", "#10b981")
                        .attr("stroke-opacity", 0.4)
                        .selectAll("line")
                        .data(data.links)
                        .join("line")
                        .attr("stroke-width", 2);

                    const node = svg.append("g")
                        .selectAll("circle")
                        .data(data.nodes)
                        .join("circle")
                        .attr("r", 10)
                        .attr("fill", d => d.group === 4 ? "#d97706" : "#6366f1")
                        .attr("stroke", "#fff")
                        .attr("stroke-width", 1.5)
                        .call(drag(simulation));

                    const label = svg.append("g")
                        .selectAll("text")
                        .data(data.nodes)
                        .join("text")
                        .attr("dy", 25)
                        .attr("text-anchor", "middle")
                        .text(d => d.id)
                        .attr("fill", "#94a3b8")
                        .attr("font-size", "10px")
                        .attr("font-weight", "bold");

                    simulation.on("tick", () => {
                        link
                            .attr("x1", d => d.source.x)
                            .attr("y1", d => d.source.y)
                            .attr("x2", d => d.target.x)
                            .attr("y2", d => d.target.y);

                        node
                            .attr("cx", d => d.x)
                            .attr("cy", d => d.y);

                        label
                            .attr("x", d => d.x)
                            .attr("y", d => d.y);
                    });

                    function drag(simulation) {
                        function dragstarted(event) {
                            if (!event.active) simulation.alphaTarget(0.3).restart();
                            event.subject.fx = event.subject.x;
                            event.subject.fy = event.subject.y;
                        }
                        function dragged(event) {
                            event.subject.fx = event.x;
                            event.subject.fy = event.y;
                        }
                        function dragended(event) {
                            if (!event.active) simulation.alphaTarget(0);
                            event.subject.fx = null;
                            event.subject.fy = null;
                        }
                        return d3.drag()
                            .on("start", dragstarted)
                            .on("drag", dragged)
                            .on("end", dragended);
                    }
                }
            }
        }
    </script>
</body>

</html>